<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consumer Dashboard - Cirkle Development Group</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/auth.css">
</head>
<body>
  <header>
    <div class="logo" onclick="window.location.href='/'">Cirkle Development Group</div>
    <nav>
      <ul>
        <li><a href="/#home">Home</a></li>
        <li><a href="/blog.html">Blog</a></li>
        <li><a href="/#contact">Contact</a></li>
      </ul>
    </nav>
    <a href="/consumer/login.html" class="staff-login">Consumer Login</a>
  </header>

  <div class="dashboard-container">
    <div class="dashboard-header">
      <h1 id="greeting-text">Welcome!</h1>
      <p>Manage your account and interact with our content</p>
    </div>

    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h2>üìù Blog Posts</h2>
        <p>Read our latest blog posts and share your thoughts in the comments.</p>
        <a href="/blog.html" class="dashboard-btn">View Blogs</a>
      </div>

      <div class="dashboard-card">
        <h2>üí° Suggest a Blog</h2>
        <p>Have an idea for a blog post? Share it with our team!</p>
        <button onclick="openSuggestionModal()" class="dashboard-btn">Submit Suggestion</button>
      </div>

      <div class="dashboard-card">
        <h2>‚öôÔ∏è Profile Settings</h2>
        <p>Update your profile information and preferences.</p>
        <button onclick="openSettingsModal()" class="dashboard-btn">Manage Profile</button>
      </div>
    </div>

    <div class="dashboard-card" style="margin-top: 20px;">
      <h2>Your Recent Activity</h2>
      <p id="activity-text">Your comments and suggestions will appear here.</p>
    </div>
  </div>

  <!-- Suggestion Modal -->
  <div id="suggestion-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Suggest a Blog Post</h2>
        <button class="modal-close" onclick="closeSuggestionModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form onsubmit="submitSuggestion(event)">
          <div class="form-group">
            <label for="suggestion-title">Blog Title</label>
            <input type="text" id="suggestion-title" required placeholder="Enter blog title">
          </div>
          <div class="form-group">
            <label for="suggestion-content">Description / Content Ideas</label>
            <textarea id="suggestion-content" required placeholder="Describe your blog post idea..."></textarea>
          </div>
          <div id="suggestion-message" class="success-message"></div>
          <button type="submit" class="auth-btn">Submit Suggestion</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Profile Settings</h2>
        <button class="modal-close" onclick="closeSettingsModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Username</label>
          <input type="text" id="settings-username" readonly>
        </div>
        <div class="form-group">
          <label>Profile Photo URL</label>
          <input type="url" id="settings-photo" placeholder="Enter image URL">
          <small style="color: #718096; font-size: 13px; margin-top: 5px; display: block;">
            Leave blank to use default avatar
          </small>
        </div>
        <div class="form-group">
          <img id="profile-preview" src="" alt="Profile Preview" style="width: 100px; height: 100px; border-radius: 50%; display: none; margin-top: 10px; object-fit: cover;">
        </div>
        <div id="settings-message" class="success-message"></div>
        <button onclick="saveSettings()" class="auth-btn">Save Changes</button>
      </div>
    </div>
  </div>

  <footer>
    ¬© Cirkle Development Group 2025 | <a href="mailto:info@cirkledevelopment.co.uk">info@cirkledevelopment.co.uk</a>
  </footer>

  <script src="../js/auth.js"></script>
  <script>
    // Check authentication
    if (!auth.isLoggedIn()) {
      window.location.href = '/consumer/login.html';
    }

    if (auth.isAdmin()) {
      window.location.href = '/admin/dashboard.html';
    }

    // Display greeting
    const greetingText = document.getElementById('greeting-text');
    greetingText.textContent = `${auth.getGreeting()}, ${auth.currentUser.username}!`;

    // Update header
    updateHeader();

    // Suggestion Modal Functions
    function openSuggestionModal() {
      document.getElementById('suggestion-modal').classList.add('active');
      document.getElementById('suggestion-message').textContent = '';
    }

    function closeSuggestionModal() {
      document.getElementById('suggestion-modal').classList.remove('active');
      document.getElementById('suggestion-title').value = '';
      document.getElementById('suggestion-content').value = '';
    }

    function submitSuggestion(event) {
      event.preventDefault();
      
      const title = document.getElementById('suggestion-title').value;
      const content = document.getElementById('suggestion-content').value;
      const messageDiv = document.getElementById('suggestion-message');

      const result = blogManager.saveSuggestion(title, content, auth.currentUser);

      if (result.success) {
        messageDiv.textContent = 'Thank you! Your suggestion has been submitted to our team.';
        setTimeout(() => {
          closeSuggestionModal();
        }, 2000);
      }
    }

    // Settings Modal Functions
    function openSettingsModal() {
      document.getElementById('settings-modal').classList.add('active');
      document.getElementById('settings-username').value = auth.currentUser.username;
      document.getElementById('settings-photo').value = auth.currentUser.profilePhoto;
      document.getElementById('settings-message').textContent = '';
      updateProfilePreview();
    }

    function closeSettingsModal() {
      document.getElementById('settings-modal').classList.remove('active');
    }

    function updateProfilePreview() {
      const photoUrl = document.getElementById('settings-photo').value;
      const preview = document.getElementById('profile-preview');
      
      if (photoUrl) {
        preview.src = photoUrl;
        preview.style.display = 'block';
      } else {
        preview.style.display = 'none';
      }
    }

    // Update preview when photo URL changes
    document.getElementById('settings-photo').addEventListener('input', updateProfilePreview);

    function saveSettings() {
      const photoUrl = document.getElementById('settings-photo').value;
      const messageDiv = document.getElementById('settings-message');

      const updates = {
        profilePhoto: photoUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(auth.currentUser.username)}&background=6b46c1&color=fff&size=128`
      };

      const result = auth.updateProfile(auth.currentUser.id, updates);

      if (result.success) {
        messageDiv.textContent = 'Settings saved successfully!';
        updateHeader();
        setTimeout(() => {
          closeSettingsModal();
        }, 1500);
      }
    }

    // Close modals when clicking outside
    window.onclick = function(event) {
      const suggestionModal = document.getElementById('suggestion-modal');
      const settingsModal = document.getElementById('settings-modal');
      
      if (event.target === suggestionModal) {
        closeSuggestionModal();
      }
      if (event.target === settingsModal) {
        closeSettingsModal();
      }
    }
  </script>
</body>
</html>
