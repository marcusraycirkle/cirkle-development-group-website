<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog Post - Cirkle Development Group</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/auth.css">
  <link rel="stylesheet" href="css/blog.css">
</head>
<body>
  <header>
    <div class="logo" onclick="window.location.href='/'">Cirkle Development Group</div>
    <nav>
      <ul>
        <li><a href="/index.html#home">Home</a></li>
        <li><a href="/blog.html">Blog</a></li>
        <li class="dropdown">
          <a href="#">About Us</a>
          <div class="dropdown-content">
            <a href="/index.html#about-who-are-we">Who are we?</a>
            <a href="/index.html#about-our-goal">Our Goal</a>
            <a href="/index.html#about-meet-executives">Meet the Executives</a>
            <a href="/index.html#about-join-us">Join Us!</a>
          </div>
        </li>
        <li class="dropdown">
          <a href="#">Subsidiaries</a>
          <div class="dropdown-content">
            <a href="/index.html#subs-cirkle-development">Cirkle Development</a>
            <a href="/index.html#subs-aer-lingus-ptfs">Aer Lingus PTFS</a>
            <a href="/index.html#subs-devden">DevDen</a>
          </div>
        </li>
        <li><a href="/index.html#contact">Contact</a></li>
      </ul>
    </nav>
    <a href="/consumer/login.html" class="staff-login">Consumer Login</a>
  </header>

  <div class="blog-post-container">
    <a href="/blog.html" class="back-to-blog">← Back to Blog</a>

    <div id="blog-content">
      <!-- Blog content will be loaded here -->
    </div>

    <div id="blog-not-found" style="display: none; text-align: center; padding: 60px 20px;">
      <h2>Blog Post Not Found</h2>
      <p>The blog post you're looking for doesn't exist.</p>
      <a href="/blog.html" class="dashboard-btn">View All Blogs</a>
    </div>
  </div>

  <footer>
    © Cirkle Development Group 2025 | <a href="mailto:info@cirkledevelopment.co.uk">info@cirkledevelopment.co.uk</a>
  </footer>

  <script src="js/auth.js"></script>
  <script>
    // Update header based on login status
    updateHeader();

    // Get blog ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const blogId = urlParams.get('id');

    // Load blog post
    function loadBlogPost() {
      if (!blogId) {
        showNotFound();
        return;
      }

      const blog = blogManager.getBlogById(blogId);
      
      if (!blog) {
        showNotFound();
        return;
      }

      // Update page title
      document.title = `${blog.title} - Cirkle Development Group`;

      const date = new Date(blog.publishDate);
      const formattedDate = date.toLocaleDateString('en-GB', { 
        day: 'numeric', 
        month: 'long', 
        year: 'numeric' 
      });

      const authorInitial = blog.author.charAt(0).toUpperCase();

      const blogContent = document.getElementById('blog-content');
      blogContent.innerHTML = `
        <div class="blog-post-banner" style="background-image: url('${blog.bannerImage}');"></div>
        
        <div class="blog-post-header">
          <h1 class="blog-post-title">${blog.title}</h1>
          <div class="blog-post-meta">
            <div class="blog-post-author">
              <div class="author-avatar">${authorInitial}</div>
              <div class="author-info">
                <div class="author-name">${blog.author}</div>
                <div class="author-email">${blog.authorEmail}</div>
              </div>
            </div>
            <div class="blog-post-date">${formattedDate}</div>
          </div>
        </div>

        <div class="blog-post-content">
          ${blog.content}
        </div>

        <div class="comments-section">
          <div class="comments-header">
            <h2>Comments (${blog.comments.length})</h2>
          </div>

          <div id="comment-form-container">
            ${auth.isLoggedIn() ? `
              <div class="comment-form">
                <textarea id="comment-text" placeholder="Share your thoughts..."></textarea>
                <button class="comment-submit" onclick="submitComment()">Post Comment</button>
                <div id="comment-message" class="success-message" style="margin-top: 15px;"></div>
              </div>
            ` : `
              <div class="login-prompt">
                <p>Please log in to leave a comment</p>
                <a href="/consumer/login.html" class="login-link">Login / Sign Up</a>
              </div>
            `}
          </div>

          <div class="comments-list" id="comments-list">
            ${blog.comments.length > 0 ? renderComments(blog.comments) : '<p style="text-align: center; color: #718096; padding: 20px;">No comments yet. Be the first to comment!</p>'}
          </div>
        </div>
      `;
    }

    function renderComments(comments) {
      return comments.map(comment => {
        const commentDate = new Date(comment.timestamp);
        const timeAgo = getTimeAgo(commentDate);

        return `
          <div class="comment">
            <div class="comment-header">
              <img src="${comment.authorPhoto}" alt="${comment.author}" class="comment-avatar">
              <span class="comment-author">${comment.author}</span>
              <span class="comment-time">${timeAgo}</span>
            </div>
            <div class="comment-content">${comment.content}</div>
          </div>
        `;
      }).join('');
    }

    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      
      if (seconds < 60) return 'Just now';
      if (seconds < 3600) return `${Math.floor(seconds / 60)} minutes ago`;
      if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`;
      if (seconds < 604800) return `${Math.floor(seconds / 86400)} days ago`;
      
      return date.toLocaleDateString('en-GB', { 
        day: 'numeric', 
        month: 'short', 
        year: 'numeric' 
      });
    }

    function submitComment() {
      const commentText = document.getElementById('comment-text');
      const messageDiv = document.getElementById('comment-message');
      
      if (!commentText.value.trim()) {
        messageDiv.textContent = 'Please write a comment';
        messageDiv.className = 'error-message';
        return;
      }

      const result = blogManager.addComment(blogId, commentText.value, auth.currentUser);

      if (result.success) {
        messageDiv.textContent = 'Comment posted successfully!';
        messageDiv.className = 'success-message';
        commentText.value = '';

        // Reload blog to show new comment
        setTimeout(() => {
          loadBlogPost();
        }, 1000);
      } else {
        messageDiv.textContent = result.message;
        messageDiv.className = 'error-message';
      }
    }

    function showNotFound() {
      document.getElementById('blog-content').style.display = 'none';
      document.getElementById('blog-not-found').style.display = 'block';
    }

    // Load blog on page load
    loadBlogPost();
  </script>
</body>
</html>
